%% genellipsis.dtx
%% Copyright 2017 F. Pijcke
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is F. Pijcke.
%
% This work consists of the files genellipsis.dtx and genellipsis.tex

\NeedsTeXFormat{LaTeX2e}

\RequirePackage{expl3}[2013/05/26]
\RequirePackage{xparse}[2013/05/26]

\ProvidesExplPackage{genellipsis}{2017/03/01}{0.1}{Generates ellipses}

\ExplSyntaxOn

\keys_define:nn { genellipsis } {
  allowbreak .bool_set:N = \l_lip_ab_bool,
  startlip .bool_set:N = \l_lip_start_bool,
  endlip .bool_set:N = \l_lip_end_bool,
  sep .code:n = { \def\lipsep{#1} },
  lip .code:n = { \def\liplip{#1} }
}

\keys_set:nn { genellipsis } {
  allowbreak,
  sep = {,},
  lip = {\dots}
}

\NewDocumentCommand \lipsetdefault { m } {
  \keys_set:nn { genellipsis } { #1 }
}

\cs_new:Nn \__lip_sep: {
  \lipsep \bool_if:NTF \l_lip_ab_bool {\allowbreak} {}
}

\seq_new:N \l_lip_sub_seq
\cs_new_protected:Nn \__lip_simple:nn {
  \seq_set_split:Nnn \l_lip_sub_seq {,} {#2}
  \seq_set_map:NNn \l_lip_sub_seq \l_lip_sub_seq {\exp_not:n {\def\v{##1} #1}}
  \seq_use:Nn \l_lip_sub_seq {\__lip_sep:}
}

\seq_new:N \l_lip_subs_seq
\NewDocumentCommand \lip { O{} D||{\v} m } {
  \keys_set:nn { genellipsis } { #1 }
  \seq_set_split:Nnn \l_lip_subs_seq {;} {#3}
  \seq_set_map:NNn \l_lip_subs_seq \l_lip_subs_seq {\exp_not:n {\__lip_simple:nn{#2}{##1}}}
  \bool_if:NTF \l_lip_start_bool { \liplip \__lip_sep: } {}
  \seq_use:Nn \l_lip_subs_seq { \__lip_sep: \liplip \__lip_sep: }
  \bool_if:NTF \l_lip_end_bool { \__lip_sep: \liplip } {}
}

\ExplSyntaxOff

